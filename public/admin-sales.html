
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ–¥–∞–∂–∏ (–∞–¥–º–∏–Ω–∫–∞)</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: left; }
    th { background: #f0f0f0; }
    #filters { margin-bottom: 1em; }
  </style>
</head>
<body>
  <h2>–ü—Ä–æ–¥–∞–∂–∏ ‚Äî –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
  <div id="filters">
    <label>–° –¥–∞—Ç—ã: <input type="date" id="fromDate" /></label>
    <label>–ü–æ –¥–∞—Ç—É: <input type="date" id="toDate" /></label>
    <label>–ü—Ä–æ–¥–∞–≤–µ—Ü ID: <input id="sellerId" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ" /></label>
    <button onclick="loadSales()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    <button onclick="downloadExcel()">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å Excel</button>
  </div>
  <table>
    <thead>
      <tr><th>–ü—Ä–æ–¥–∞–≤–µ—Ü</th><th>–¢–æ–≤–∞—Ä</th><th>–ö–æ–ª-–≤–æ</th><th>–í—Ä–µ–º—è</th></tr>
    </thead>
    <tbody id="salesBody"></tbody>
  </table>

  <script>
    async function loadSales() {
      const from = document.getElementById('fromDate').value;
      const to = document.getElementById('toDate').value;
      const seller_id = document.getElementById('sellerId').value;
      const query = `?from=${from}&to=${to}&seller_id=${seller_id}`;
      const res = await fetch('/api/sales' + query);
      const data = await res.json();
      const body = document.getElementById('salesBody');
      body.innerHTML = '';
      data.forEach(sale => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${sale.seller}</td>
          <td>${sale.product}</td>
          <td>${sale.quantity}</td>
          <td>${sale.sale_time}</td>
        `;
        body.appendChild(row);
      });
    }

    async function downloadExcel() {
      const from = document.getElementById('fromDate').value;
      const to = document.getElementById('toDate').value;
      const link = document.createElement('a');
      link.href = `/api/sales/export?from=${from}&to=${to}`;
      link.click();
    }

    setInterval(loadSales, 10000);
    window.onload = () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('fromDate').value = today;
      document.getElementById('toDate').value = today;
      loadSales();
    };
  </script>
</body>
</html>
