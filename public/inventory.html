
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Инвентарь</title>
  <script>
    async function loadInventory() {
      const date = document.getElementById('date').value;
      const seller_id = document.getElementById('seller_id').value;
      const res = await fetch(`/api/inventory?date=${date}&seller_id=${seller_id}`);
      const data = await res.json();
      const table = document.getElementById('inventory');
      table.innerHTML = '';
      data.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = \`
          <td>\${item.product_id}</td>
          <td><input type="number" value="\${item.opening_balance || 0}" onchange="updateItem(\${item.product_id}, 'opening_balance', this.value)" /></td>
          <td><input type="number" value="\${item.receipt || 0}" onchange="updateItem(\${item.product_id}, 'receipt', this.value)" /></td>
          <td><input type="number" value="\${item.transfer || 0}" onchange="updateItem(\${item.product_id}, 'transfer', this.value)" /></td>
          <td><input type="number" value="\${item.write_off || 0}" onchange="updateItem(\${item.product_id}, 'write_off', this.value)" /></td>
          <td><input type="number" value="\${item.lunches || 0}" onchange="updateItem(\${item.product_id}, 'lunches', this.value)" /></td>
          <td><input type="number" value="\${item.closing_balance || 0}" onchange="updateItem(\${item.product_id}, 'closing_balance', this.value)" /></td>
        \`;
        table.appendChild(row);
      });
    }

    async function updateItem(product_id, field, value) {
      const date = document.getElementById('date').value;
      const seller_id = document.getElementById('seller_id').value;
      const row = [...document.getElementById('inventory').children].find(r => r.children[0].innerText == product_id);
      const data = {
        seller_id,
        product_id,
        date,
        opening_balance: row.children[1].children[0].value,
        receipt: row.children[2].children[0].value,
        transfer: row.children[3].children[0].value,
        write_off: row.children[4].children[0].value,
        lunches: row.children[5].children[0].value,
        closing_balance: row.children[6].children[0].value,
      };
      await fetch('/api/inventory', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
    }

    window.onload = loadInventory;
  </script>
</head>
<body>
  <h1>Учёт остатков</h1>
  <label>Дата: <input type="date" id="date" value="2025-07-03"/></label>
  <label>Продавец ID: <input id="seller_id" value="1"/></label>
  <button onclick="loadInventory()">Загрузить</button>
  <table border="1">
    <thead>
      <tr>
        <th>Товар</th><th>Остаток нач.</th><th>Поступление</th><th>Перемещение</th>
        <th>Списание</th><th>Обеды</th><th>Остаток кон.</th>
      </tr>
    </thead>
    <tbody id="inventory"></tbody>
  </table>
</body>
</html>
