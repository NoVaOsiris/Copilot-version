
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin — Products</title>
    <script>
        async function loadProducts() {
            const res = await fetch('/api/products');
            const products = await res.json();
            const table = document.getElementById('products');
            table.innerHTML = '';
            products.forEach(p => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input value="\${p.name}" onchange="editProduct(\${p.id}, this.value, 'name')"/></td>
                    <td><input type="number" value="\${p.price}" onchange="editProduct(\${p.id}, this.value, 'price')"/></td>
                    <td><button onclick="deleteProduct(\${p.id})">Удалить</button></td>
                `;
                table.appendChild(row);
            });
        }

        async function editProduct(id, value, field) {
            const row = [...document.getElementById('products').children].find(r => 
                +r.children[2].children[0].getAttribute('onclick').match(/\d+/)[0] === id);
            const name = row.children[0].children[0].value;
            const price = row.children[1].children[0].value;
            await fetch('/api/products', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id, name, price })
            });
            loadProducts();
        }

        async function deleteProduct(id) {
            await fetch('/api/products/' + id, { method: 'DELETE' });
            loadProducts();
        }

        async function addProduct() {
            const name = prompt('Название:');
            const price = prompt('Цена:');
            if (name && price) {
                await fetch('/api/products', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ name, price })
                });
                loadProducts();
            }
        }

        window.onload = loadProducts;
    </script>
</head>
<body>
    <h1>Продукты</h1>
    <button onclick="addProduct()">Добавить продукт</button>
    <table border="1">
        <thead><tr><th>Название</th><th>Цена</th><th></th></tr></thead>
        <tbody id="products"></tbody>
    </table>
</body>
</html>
