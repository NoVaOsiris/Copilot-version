
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Продажа товара</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    select, input, button { display: block; margin: 1em 0; padding: 0.5em; font-size: 1em; }
  </style>
</head>
<body>
  <h2>Продажа</h2>
  <label>Товар:
    <select id="productSelect"></select>
  </label>
  <label>Количество:
    <input type="number" id="quantity" />
  </label>
  <button onclick="sell()">Продать</button>
  <p id="status"></p>

  <script>
    async function loadProducts() {
      const res = await fetch('/api/products');
      const products = await res.json();
      const select = document.getElementById('productSelect');
      products.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = p.name;
        select.appendChild(option);
      });
    }

    async function sell() {
      const product_id = document.getElementById('productSelect').value;
      const quantity = document.getElementById('quantity').value;
      const res = await fetch('/api/sales', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ product_id, quantity })
      });
      const msg = await res.json();
      document.getElementById('status').textContent = msg.success ? "Продажа выполнена!" : "Ошибка";
    }

    loadProducts();
  </script>
</body>
</html>
